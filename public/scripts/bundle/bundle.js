/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={811:e=>{e.exports={Stickers:[{name:"amongus",count:"25",icon:"11"},{name:"cat",count:"29",icon:"15"},{name:"emojis",count:"26",icon:"9"},{name:"soul",count:"25",icon:"14"},{name:"anime",count:"25",icon:"22"},{name:"robo",count:"16",icon:"14"},{name:"crab",count:"24",icon:"1"},{name:"cutecat",count:"33",icon:"30"},{name:"skully",count:"24",icon:"23"},{name:"monkey",count:"24",icon:"4"},{name:"frog",count:"30",icon:"18"}]}}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};s.r(e),s.d(e,{Decoder:()=>ie,Encoder:()=>ae,PacketType:()=>oe,protocol:()=>ne});const t=Object.create(null);t.open="0",t.close="1",t.ping="2",t.pong="3",t.message="4",t.upgrade="5",t.noop="6";const n=Object.create(null);Object.keys(t).forEach((e=>{n[t[e]]=e}));const o={type:"error",data:"parser error"},a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),i="function"==typeof ArrayBuffer,r=(e,t)=>{const s=new FileReader;return s.onload=function(){const e=s.result.split(",")[1];t("b"+e)},s.readAsDataURL(e)},c=({type:e,data:s},n,o)=>{return a&&s instanceof Blob?n?o(s):r(s,o):i&&(s instanceof ArrayBuffer||(c=s,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(c):c&&c.buffer instanceof ArrayBuffer))?n?o(s):r(new Blob([s]),o):o(t[e]+(s||""));var c},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<l.length;e++)d[l.charCodeAt(e)]=e;const u="function"==typeof ArrayBuffer,p=(e,t)=>{if(u){const s=(e=>{let t,s,n,o,a,i=.75*e.length,r=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);const l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<r;t+=4)s=d[e.charCodeAt(t)],n=d[e.charCodeAt(t+1)],o=d[e.charCodeAt(t+2)],a=d[e.charCodeAt(t+3)],u[c++]=s<<2|n>>4,u[c++]=(15&n)<<4|o>>2,u[c++]=(3&o)<<6|63&a;return l})(e);return m(s,t)}return{base64:!0,data:e}},m=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,h=(e,t)=>{if("string"!=typeof e)return{type:"message",data:m(e,t)};const s=e.charAt(0);return"b"===s?{type:"message",data:p(e.substring(1),t)}:n[s]?e.length>1?{type:n[s],data:e.substring(1)}:{type:n[s]}:o},g=String.fromCharCode(30);function y(e){if(e)return function(e){for(var t in y.prototype)e[t]=y.prototype[t];return e}(e)}y.prototype.on=y.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},y.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},y.prototype.off=y.prototype.removeListener=y.prototype.removeAllListeners=y.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<n.length;o++)if((s=n[o])===t||s.fn===t){n.splice(o,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},y.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(s){n=0;for(var o=(s=s.slice(0)).length;n<o;++n)s[n].apply(this,t)}return this},y.prototype.emitReserved=y.prototype.emit,y.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},y.prototype.hasListeners=function(e){return!!this.listeners(e).length};const f="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function v(e,...t){return t.reduce(((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t)),{})}const b=setTimeout,x=clearTimeout;function E(e,t){t.useNativeTimers?(e.setTimeoutFn=b.bind(f),e.clearTimeoutFn=x.bind(f)):(e.setTimeoutFn=setTimeout.bind(f),e.clearTimeoutFn=clearTimeout.bind(f))}class w extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class S extends y{constructor(e){super(),this.writable=!1,E(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,s){return super.emitReserved("error",new w(e,t,s)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=h(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const k="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),L={};let I,C=0,B=0;function q(e){let t="";do{t=k[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function T(){const e=q(+new Date);return e!==I?(C=0,I=e):e+"."+q(C++)}for(;B<64;B++)L[k[B]]=B;function _(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}let R=!1;try{R="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const A=R;function O(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||A))return new XMLHttpRequest}catch(e){}if(!t)try{return new(f[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function M(){}const N=null!=new O({xdomain:!1}).responseType;class $ extends y{constructor(e,t){super(),E(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=v(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new O(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=$.requestsCount++,$.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=M,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete $.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function D(){for(let e in $.requests)$.requests.hasOwnProperty(e)&&$.requests[e].abort()}$.requestsCount=0,$.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",D):"function"==typeof addEventListener&&addEventListener("onpagehide"in f?"pagehide":"unload",D,!1));const P="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),F=f.WebSocket||f.MozWebSocket,j="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),U={websocket:class extends S{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,s=j?{}:v(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=j?new F(e,t,s):t?new F(e,t):new F(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;c(s,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}n&&P((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=T()),this.supportsBinary||(e.b64=1);const n=_(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(n.length?"?"+n:"")}check(){return!!F}},polling:class extends S{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=N&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const s=e.split(g),n=[];for(let e=0;e<s.length;e++){const o=h(s[e],t);if(n.push(o),"error"===o.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const s=e.length,n=new Array(s);let o=0;e.forEach(((e,a)=>{c(e,!1,(e=>{n[a]=e,++o===s&&t(n.join(g))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=T()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(s=":"+this.opts.port);const n=_(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new $(this.uri(),e)}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},z=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,H=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Y(e){const t=e,s=e.indexOf("["),n=e.indexOf("]");-1!=s&&-1!=n&&(e=e.substring(0,s)+e.substring(s,n).replace(/:/g,";")+e.substring(n,e.length));let o=z.exec(e||""),a={},i=14;for(;i--;)a[H[i]]=o[i]||"";return-1!=s&&-1!=n&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){const s=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||s.splice(0,1),"/"==t.slice(-1)&&s.splice(s.length-1,1),s}(0,a.path),a.queryKey=function(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(s[t]=n)})),s}(0,a.query),a}class V extends y{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=Y(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Y(t.host).host),E(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},s=e.split("&");for(let e=0,n=s.length;e<n;e++){let n=s[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new U[e](s)}open(){let e;if(this.opts.rememberUpgrade&&V.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),s=!1;V.priorWebsocketSuccess=!1;const n=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!s)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;V.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{s||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function o(){s||(s=!0,l(),t.close(),t=null)}const a=e=>{const s=new Error("probe error: "+e);s.transport=t.name,o(),this.emitReserved("upgradeError",s)};function i(){a("transport closed")}function r(){a("socket closed")}function c(e){t&&e.name!==t.name&&o()}const l=()=>{t.removeListener("open",n),t.removeListener("error",a),t.removeListener("close",i),this.off("close",r),this.off("upgrading",c)};t.once("open",n),t.once("error",a),t.once("close",i),this.once("close",r),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",V.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let s=0;s<this.writeBuffer.length;s++){const n=this.writeBuffer[s].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,s=0;for(let n=0,o=e.length;n<o;n++)t=e.charCodeAt(n),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(n++,s+=4);return s}(t):Math.ceil(1.33*(t.byteLength||t.size))),s>0&&e>this.maxPayload)return this.writeBuffer.slice(0,s);e+=2}var t;return this.writeBuffer}write(e,t,s){return this.sendPacket("message",e,t,s),this}send(e,t,s){return this.sendPacket("message",e,t,s),this}sendPacket(e,t,s,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof s&&(n=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const o={type:e,data:t,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():e()})):this.upgrading?s():e()),this}onError(e){V.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let s=0;const n=e.length;for(;s<n;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}V.protocol=4,V.protocol;const X="function"==typeof ArrayBuffer,W=Object.prototype.toString,K="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===W.call(Blob),G="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===W.call(File);function J(e){return X&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||K&&e instanceof Blob||G&&e instanceof File}function Z(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)if(Z(e[t]))return!0;return!1}if(J(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Z(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&Z(e[t]))return!0;return!1}function Q(e){const t=[],s=e.data,n=e;return n.data=ee(s,t),n.attachments=t.length,{packet:n,buffers:t}}function ee(e,t){if(!e)return e;if(J(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let n=0;n<e.length;n++)s[n]=ee(e[n],t);return s}if("object"==typeof e&&!(e instanceof Date)){const s={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=ee(e[n],t));return s}return e}function te(e,t){return e.data=se(e.data,t),e.attachments=void 0,e}function se(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=se(e[s],t);else if("object"==typeof e)for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=se(e[s],t));return e}const ne=5;var oe;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(oe||(oe={}));class ae{constructor(e){this.replacer=e}encode(e){return e.type!==oe.EVENT&&e.type!==oe.ACK||!Z(e)?[this.encodeAsString(e)]:(e.type=e.type===oe.EVENT?oe.BINARY_EVENT:oe.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==oe.BINARY_EVENT&&e.type!==oe.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Q(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}}class ie extends y{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e),t.type===oe.BINARY_EVENT||t.type===oe.BINARY_ACK?(this.reconstructor=new re(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!J(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===oe[s.type])throw new Error("unknown packet type "+s.type);if(s.type===oe.BINARY_EVENT||s.type===oe.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const o=e.substring(n,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(o)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);s.nsp=e.substring(n,t)}else s.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!ie.isPayloadValid(s.type,n))throw new Error("invalid payload");s.data=n}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case oe.CONNECT:return"object"==typeof t;case oe.DISCONNECT:return void 0===t;case oe.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case oe.EVENT:case oe.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case oe.ACK:case oe.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class re{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=te(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ce(e,t,s){return e.on(t,s),function(){e.off(t,s)}}const le=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class de extends y{constructor(e,t,s){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ce(e,"open",this.onopen.bind(this)),ce(e,"packet",this.onpacket.bind(this)),ce(e,"error",this.onerror.bind(this)),ce(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(le.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');t.unshift(e);const s={type:oe.EVENT,data:t,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),s.id=e}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,t){const s=this.flags.timeout;if(void 0===s)return void(this.acks[e]=t);const n=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),s);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...e])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this.packet({type:oe.CONNECT,data:e})})):this.packet({type:oe.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case oe.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case oe.EVENT:case oe.BINARY_EVENT:this.onevent(e);break;case oe.ACK:case oe.BINARY_ACK:this.onack(e);break;case oe.DISCONNECT:this.ondisconnect();break;case oe.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let s=!1;return function(...n){s||(s=!0,t.packet({type:oe.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:oe.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function ue(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ue.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-s:e+s}return 0|Math.min(e,this.max)},ue.prototype.reset=function(){this.attempts=0},ue.prototype.setMin=function(e){this.ms=e},ue.prototype.setMax=function(e){this.max=e},ue.prototype.setJitter=function(e){this.jitter=e};class pe extends y{constructor(t,s){var n;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(s=t,t=void 0),(s=s||{}).path=s.path||"/socket.io",this.opts=s,E(this,s),this.reconnection(!1!==s.reconnection),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=s.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new ue({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==s.timeout?2e4:s.timeout),this._readyState="closed",this.uri=t;const o=s.parser||e;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=!1!==s.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new V(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=ce(t,"open",(function(){s.onopen(),e&&e()})),o=ce(t,"error",(t=>{s.cleanup(),s._readyState="closed",this.emitReserved("error",t),e?e(t):s.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&n();const s=this.setTimeoutFn((()=>{n(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(n),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ce(e,"ping",this.onping.bind(this)),ce(e,"data",this.ondata.bind(this)),ce(e,"error",this.onerror.bind(this)),ce(e,"close",this.onclose.bind(this)),ce(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){P((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s||(s=new de(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const me={};function he(e,t){"object"==typeof e&&(t=e,e=void 0);const s=function(e,t="",s){let n=e;s=s||"undefined"!=typeof location&&location,null==e&&(e=s.protocol+"//"+s.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==s?s.protocol+"//"+e:"https://"+e),n=Y(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+t,n.href=n.protocol+"://"+o+(s&&s.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=s.source,o=s.id,a=s.path,i=me[o]&&a in me[o].nsps;let r;return t.forceNew||t["force new connection"]||!1===t.multiplex||i?r=new pe(n,t):(me[o]||(me[o]=new pe(n,t)),r=me[o]),s.query&&!t.query&&(t.query=s.queryKey),r.socket(s.path,t)}Object.assign(he,{Manager:pe,Socket:de,io:he,connect:he});var ge=Object.prototype.toString,ye=Array.isArray||function(e){return"[object Array]"===ge.call(e)};function fe(e){return"function"==typeof e}function ve(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function be(e,t){return null!=e&&"object"==typeof e&&t in e}var xe=RegExp.prototype.test,Ee=/\S/;var we={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},Se=/\s*/,ke=/\s+/,Le=/\s*=/,Ie=/\s*\}/,Ce=/#|\^|\/|>|\{|&|=|!/;function Be(e){this.string=e,this.tail=e,this.pos=0}function qe(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function Te(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}Be.prototype.eos=function(){return""===this.tail},Be.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var s=t[0];return this.tail=this.tail.substring(s.length),this.pos+=s.length,s},Be.prototype.scanUntil=function(e){var t,s=this.tail.search(e);switch(s){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,s),this.tail=this.tail.substring(s)}return this.pos+=t.length,t},qe.prototype.push=function(e){return new qe(e,this)},qe.prototype.lookup=function(e){var t,s,n,o=this.cache;if(o.hasOwnProperty(e))t=o[e];else{for(var a,i,r,c=this,l=!1;c;){if(e.indexOf(".")>0)for(a=c.view,i=e.split("."),r=0;null!=a&&r<i.length;)r===i.length-1&&(l=be(a,i[r])||(s=a,n=i[r],null!=s&&"object"!=typeof s&&s.hasOwnProperty&&s.hasOwnProperty(n))),a=a[i[r++]];else a=c.view[e],l=be(c.view,e);if(l){t=a;break}c=c.parent}o[e]=t}return fe(t)&&(t=t.call(this.view)),t},Te.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},Te.prototype.parse=function(e,t){var s=this.templateCache,n=e+":"+(t||_e.tags).join(":"),o=void 0!==s,a=o?s.get(n):void 0;return null==a&&(a=function(e,t){if(!e)return[];var s,n,o,a,i=!1,r=[],c=[],l=[],d=!1,u=!1,p="",m=0;function h(){if(d&&!u)for(;l.length;)delete c[l.pop()];else l=[];d=!1,u=!1}function g(e){if("string"==typeof e&&(e=e.split(ke,2)),!ye(e)||2!==e.length)throw new Error("Invalid tags: "+e);s=new RegExp(ve(e[0])+"\\s*"),n=new RegExp("\\s*"+ve(e[1])),o=new RegExp("\\s*"+ve("}"+e[1]))}g(t||_e.tags);for(var y,f,v,b,x,E,w=new Be(e);!w.eos();){if(y=w.pos,v=w.scanUntil(s))for(var S=0,k=v.length;S<k;++S)a=b=v.charAt(S),function(e,t){return xe.call(e,t)}(Ee,a)?(u=!0,i=!0,p+=" "):(l.push(c.length),p+=b),c.push(["text",b,y,y+1]),y+=1,"\n"===b&&(h(),p="",m=0,i=!1);if(!w.scan(s))break;if(d=!0,f=w.scan(Ce)||"name",w.scan(Se),"="===f?(v=w.scanUntil(Le),w.scan(Le),w.scanUntil(n)):"{"===f?(v=w.scanUntil(o),w.scan(Ie),w.scanUntil(n),f="&"):v=w.scanUntil(n),!w.scan(n))throw new Error("Unclosed tag at "+w.pos);if(x=">"==f?[f,v,y,w.pos,p,m,i]:[f,v,y,w.pos],m++,c.push(x),"#"===f||"^"===f)r.push(x);else if("/"===f){if(!(E=r.pop()))throw new Error('Unopened section "'+v+'" at '+y);if(E[1]!==v)throw new Error('Unclosed section "'+E[1]+'" at '+y)}else"name"===f||"{"===f||"&"===f?u=!0:"="===f&&g(v)}if(h(),E=r.pop())throw new Error('Unclosed section "'+E[1]+'" at '+w.pos);return function(e){for(var t,s=[],n=s,o=[],a=0,i=e.length;a<i;++a)switch((t=e[a])[0]){case"#":case"^":n.push(t),o.push(t),n=t[4]=[];break;case"/":o.pop()[5]=t[2],n=o.length>0?o[o.length-1][4]:s;break;default:n.push(t)}return s}(function(e){for(var t,s,n=[],o=0,a=e.length;o<a;++o)(t=e[o])&&("text"===t[0]&&s&&"text"===s[0]?(s[1]+=t[1],s[3]=t[3]):(n.push(t),s=t));return n}(c))}(e,t),o&&s.set(n,a)),a},Te.prototype.render=function(e,t,s,n){var o=this.getConfigTags(n),a=this.parse(e,o),i=t instanceof qe?t:new qe(t,void 0);return this.renderTokens(a,i,s,e,n)},Te.prototype.renderTokens=function(e,t,s,n,o){for(var a,i,r,c="",l=0,d=e.length;l<d;++l)r=void 0,"#"===(i=(a=e[l])[0])?r=this.renderSection(a,t,s,n,o):"^"===i?r=this.renderInverted(a,t,s,n,o):">"===i?r=this.renderPartial(a,t,s,o):"&"===i?r=this.unescapedValue(a,t):"name"===i?r=this.escapedValue(a,t,o):"text"===i&&(r=this.rawValue(a)),void 0!==r&&(c+=r);return c},Te.prototype.renderSection=function(e,t,s,n,o){var a=this,i="",r=t.lookup(e[1]);if(r){if(ye(r))for(var c=0,l=r.length;c<l;++c)i+=this.renderTokens(e[4],t.push(r[c]),s,n,o);else if("object"==typeof r||"string"==typeof r||"number"==typeof r)i+=this.renderTokens(e[4],t.push(r),s,n,o);else if(fe(r)){if("string"!=typeof n)throw new Error("Cannot use higher-order sections without the original template");null!=(r=r.call(t.view,n.slice(e[3],e[5]),(function(e){return a.render(e,t,s,o)})))&&(i+=r)}else i+=this.renderTokens(e[4],t,s,n,o);return i}},Te.prototype.renderInverted=function(e,t,s,n,o){var a=t.lookup(e[1]);if(!a||ye(a)&&0===a.length)return this.renderTokens(e[4],t,s,n,o)},Te.prototype.indentPartial=function(e,t,s){for(var n=t.replace(/[^ \t]/g,""),o=e.split("\n"),a=0;a<o.length;a++)o[a].length&&(a>0||!s)&&(o[a]=n+o[a]);return o.join("\n")},Te.prototype.renderPartial=function(e,t,s,n){if(s){var o=this.getConfigTags(n),a=fe(s)?s(e[1]):s[e[1]];if(null!=a){var i=e[6],r=e[5],c=e[4],l=a;0==r&&c&&(l=this.indentPartial(a,c,i));var d=this.parse(l,o);return this.renderTokens(d,t,s,l,n)}}},Te.prototype.unescapedValue=function(e,t){var s=t.lookup(e[1]);if(null!=s)return s},Te.prototype.escapedValue=function(e,t,s){var n=this.getConfigEscape(s)||_e.escape,o=t.lookup(e[1]);if(null!=o)return"number"==typeof o&&n===_e.escape?String(o):n(o)},Te.prototype.rawValue=function(e){return e[1]},Te.prototype.getConfigTags=function(e){return ye(e)?e:e&&"object"==typeof e?e.tags:void 0},Te.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!ye(e)?e.escape:void 0};var _e={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){Re.templateCache=e},get templateCache(){return Re.templateCache}},Re=new Te;_e.clearCache=function(){return Re.clearCache()},_e.parse=function(e,t){return Re.parse(e,t)},_e.render=function(e,t,s,n){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(ye(o=e)?"array":typeof o)+'" was given as the first argument for mustache#render(template, view, partials)');var o;return Re.render(e,t,s,n)},_e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return we[e]}))},_e.Scanner=Be,_e.Context=qe,_e.Writer=Te;const Ae=_e;var Oe=s(811);class Me{constructor(e,t,s,n,o){this.increment=n,this.minScale=t,this.maxScale=s,this.liner=o,this.panning=!1,this.oldX=this.oldY=0;let a=this;e.style.transform="matrix(1, 0, 0, 1, 0, 0)",this.getTransformMatrix=function(){let t=e.style.transform,s=t.indexOf("(")+1,n=t.indexOf(")"),o=t.slice(s,n).split(",");return{scale:+o[0],transX:+o[4],transY:+o[5]}},this.setTransformMatrix=function(t){e.style.transform="matrix("+t.scale+", 0, 0, "+t.scale+", "+t.transX+", "+t.transY+")"},this.applyTranslate=function(e,t){let s=this.getTransformMatrix();s.transX+=e,s.transY+=t,this.setTransformMatrix(s)},this.applyScale=function(t,s,n){let o=this.getTransformMatrix(),a=s-(e.width?e.width:e.offsetWidth)/2,i=n-(e.height?e.height:e.offsetHeight)/2;t=this.liner?t:t*o.scale,o.scale+=t;let r=o.scale<=this.minScale||o.scale>=this.maxScale;o.scale<this.minScale&&(o.scale=this.minScale),o.scale>this.maxScale&&(o.scale=this.maxScale),r||(this.applyTranslate(a,i),this.setTransformMatrix(o),this.applyTranslate(-a*t,-i*t))},e.addEventListener("mousedown",(function(e){e.preventDefault(),this.panning=!0,this.oldX=e.clientX,this.oldY=e.clientY})),e.addEventListener("mouseup",(function(e){this.panning=!1})),e.addEventListener("mouseleave",(function(e){this.panning=!1})),e.addEventListener("mousemove",(function(e){if(this.panning){let t=e.clientX-this.oldX,s=e.clientY-this.oldY;a.applyTranslate(t,s),this.oldX=e.clientX,this.oldY=e.clientY}})),e.addEventListener("dblclick",(function(e){let t=a.getTransformMatrix();t.scale=1,t.transX=0,t.transY=0,a.setTransformMatrix(t)})),this.getScrollDirection=function(e){Math.max(-1,Math.min(1,e.wheelDelta||-e.detail))<0?a.applyScale(-a.increment,e.offsetX,e.offsetY):a.applyScale(a.increment,e.offsetX,e.offsetY)},e.addEventListener("DOMMouseScroll",this.getScrollDirection,!1),e.addEventListener("mousewheel",this.getScrollDirection,!1)}}console.log("loaded");const Ne=he(),$e=he("/file"),De=document.getElementById("messages"),Pe=window.innerHeight,Fe=document.getElementById("replyToast"),je=document.getElementById("lightbox__close"),Ue=document.getElementById("textbox"),ze=document.querySelector(".copyOption"),He=document.querySelector(".downloadOption"),Ye=document.querySelector(".deleteOption"),Ve=document.querySelector(".replyOption"),Xe=document.querySelector(".fileDropZone"),We=document.getElementById("showMoreReactBtn"),Ke=new Audio("/sounds/incommingmessage.mp3"),Ge=new Audio("/sounds/outgoingmessage.mp3"),Je=new Audio("/sounds/join.mp3"),Ze=new Audio("/sounds/leave.mp3"),Qe=new Audio("/sounds/typing.mp3"),et=new Audio("/sounds/location.mp3"),tt=new Audio("/sounds/react.mp3"),st=new Audio("/sounds/click.mp3"),nt=new Audio("/sounds/sticker.mp3"),ot=document.getElementById("send"),at=document.getElementById("photo"),it=document.getElementById("file");let rt,ct=!1;const lt=document.getElementById("myId").textContent,dt=document.getElementById("myName").textContent,ut=document.getElementById("myAvatar").textContent,pt=document.getElementById("myKey").textContent,mt=document.getElementById("maxUser").textContent,ht=document.getElementById("messageTemplate").innerHTML,gt=document.getElementById("fileTemplate").innerHTML;document.getElementById("userMetaTemplate").remove(),document.getElementById("messageTemplate").remove(),document.getElementById("fileTemplate").remove();let yt="";const ft={blue:{secondary:"hsl(213, 98%, 57%)",foreground:"#e1eeff",msg_get:"hsl(213, 40%, 57%)",msg_get_reply:"hsl(213, 35%, 27%)",msg_send:"hsl(213, 98%, 57%)",msg_send_reply:"hsl(213, 88%, 27%)"},geometry:{secondary:"hsl(15, 98%, 57%)",foreground:"#e1eeff",msg_get:"hsl(15, 40%, 57%)",msg_get_reply:"hsl(15, 35%, 27%)",msg_send:"hsl(15, 98%, 57%)",msg_send_reply:"hsl(15, 88%, 27%)"},dark_mood:{secondary:"hsl(216, 37%, 44%)",foreground:"#e1eeff",msg_get:"hsl(216, 27%, 33%)",msg_get_reply:"hsl(216, 20%, 21%)",msg_send:"hsl(216, 37%, 44%)",msg_send_reply:"hsl(216, 32%, 23%)"},forest:{secondary:"hsl(162, 60%, 42%)",foreground:"#e1eeff",msg_get:"hsl(162, 18%, 41%)",msg_get_reply:"hsl(162, 14%, 27%)",msg_send:"hsl(162, 60%, 42%)",msg_send_reply:"hsl(162, 32%, 34%)"}},vt={primary:["ðŸ™‚","ðŸ˜‚","ðŸ˜ ","ðŸ˜¢","ðŸ˜®","ðŸ’™","ðŸŒ»"],last:"ðŸŒ»",expanded:["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜ƒ","ðŸ˜„","ðŸ˜…","ðŸ˜†","ðŸ˜‰","ðŸ˜Š","ðŸ˜‹","ðŸ˜Ž","ðŸ˜","ðŸ˜˜","ðŸ¥°","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ™‚","ðŸ¤—","ðŸ¤©","ðŸ¤”","ðŸ¤¨","ðŸ˜","ðŸ˜‘","ðŸ˜¶","ðŸ™„","ðŸ˜","ðŸ˜£","ðŸ˜¥","ðŸ˜®","ðŸ¤","ðŸ˜¯","ðŸ˜ª","ðŸ˜«","ðŸ¥±","ðŸ˜´","ðŸ˜Œ","ðŸ˜›","ðŸ˜œ","ðŸ˜","ðŸ¤¤","ðŸ˜’","ðŸ˜“","ðŸ˜”","ðŸ˜•","ðŸ™ƒ","ðŸ¤‘","ðŸ˜²","ðŸ™","ðŸ˜–","ðŸ˜ž","ðŸ˜Ÿ","ðŸ˜¤","ðŸ˜¢","ðŸ˜­","ðŸ˜¦","ðŸ˜§","ðŸ˜¨","ðŸ˜©","ðŸ¤¯","ðŸ˜¬","ðŸ˜°","ðŸ˜±","ðŸ¥µ","ðŸ¥¶","ðŸ˜³","ðŸ¤ª","ðŸ˜µ","ðŸ¥´","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤¢","ðŸ¤®","ðŸ¤§","ðŸ˜‡","ðŸ¥³","ðŸ¥º","ðŸ¤ ","ðŸ¤¡","ðŸ¤¥","ðŸ¤«","ðŸ¤­","ðŸ§","ðŸ¤“","ðŸ˜ˆ","ðŸ‘¿","ðŸ‘¹","ðŸ‘º","ðŸ’€","â˜ ","ðŸ‘»","ðŸ‘½","ðŸ‘¾","ðŸ¤–","ðŸ’©","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸµ","ðŸ¶","ðŸº","ðŸ±","ðŸ¦","ðŸ¯","ðŸ¦’","ðŸ¦Š","ðŸ¦","ðŸ®","ðŸ·","ðŸ—","ðŸ­","ðŸ¹","ðŸ°","ðŸ»","ðŸ¨","ðŸ¼","ðŸ¸","ðŸ¦“","ðŸ´","ðŸ¦„","ðŸ”","ðŸ²","ðŸ½","ðŸ§","ðŸ¥","ðŸ¤","ðŸ£","ðŸŒ»","ðŸŒ¸","ðŸ¥€","ðŸŒ¼","ðŸŒ·","ðŸŒ¹","ðŸµï¸","ðŸŒº","ðŸ¦‡","ðŸ¦‹","ðŸŒ","ðŸ›","ðŸ¦Ÿ","ðŸ¦—","ðŸœ","ðŸ","ðŸž","ðŸ¦‚","ðŸ•·","ðŸ•¸","ðŸ¦ ","ðŸ§žâ€â™€ï¸","ðŸ§žâ€â™‚ï¸","ðŸ—£","ðŸ‘€","ðŸ¦´","ðŸ¦·","ðŸ‘…","ðŸ‘„","ðŸ§ ","ðŸ¦¾","ðŸ¦¿","ðŸ‘©ðŸ»","ðŸ‘¨ðŸ»","ðŸ§‘ðŸ»","ðŸ‘§ðŸ»","ðŸ‘¦ðŸ»","ðŸ§’ðŸ»","ðŸ‘¶ðŸ»","ðŸ‘µðŸ»","ðŸ‘´ðŸ»","ðŸ§“ðŸ»","ðŸ‘©ðŸ»â€ðŸ¦°","ðŸ‘¨ðŸ»â€ðŸ¦°","ðŸ‘©ðŸ»â€ðŸ¦±","ðŸ‘¨ðŸ»â€ðŸ¦±","ðŸ‘©ðŸ»â€ðŸ¦²","ðŸ‘¨ðŸ»â€ðŸ¦²","ðŸ‘©ðŸ»â€ðŸ¦³","ðŸ‘¨ðŸ»â€ðŸ¦³","ðŸ‘±ðŸ»â€â™€ï¸","ðŸ‘±ðŸ»â€â™‚ï¸","ðŸ‘¸ðŸ»","ðŸ¤´ðŸ»","ðŸ‘³ðŸ»â€â™€ï¸","ðŸ‘³ðŸ»â€â™‚ï¸","ðŸ‘²ðŸ»","ðŸ§”ðŸ»","ðŸ‘¼ðŸ»","ðŸ¤¶ðŸ»","ðŸŽ…ðŸ»","ðŸ‘®ðŸ»â€â™€ï¸","ðŸ‘®ðŸ»â€â™‚ï¸","ðŸ•µðŸ»â€â™€ï¸","ðŸ•µðŸ»â€â™‚ï¸","ðŸ’‚ðŸ»â€â™€ï¸","ðŸ’‚ðŸ»â€â™‚ï¸","ðŸ‘·ðŸ»â€â™€ï¸","ðŸ‘·ðŸ»â€â™‚ï¸","ðŸ‘©ðŸ»â€âš•ï¸","ðŸ‘¨ðŸ»â€âš•ï¸","ðŸ‘©ðŸ»â€ðŸŽ“","ðŸ‘¨ðŸ»â€ðŸŽ“","ðŸ‘©ðŸ»â€ðŸ«","ðŸ‘¨ðŸ»â€ðŸ«","ðŸ‘©ðŸ»â€âš–ï¸","ðŸ‘¨ðŸ»â€âš–ï¸","ðŸ‘©ðŸ»â€ðŸŒ¾","ðŸ‘¨ðŸ»â€ðŸŒ¾","ðŸ‘©ðŸ»â€ðŸ³","ðŸ‘¨ðŸ»â€ðŸ³","ðŸ‘©ðŸ»â€ðŸ”§","ðŸ‘¨ðŸ»â€ðŸ”§","ðŸ‘©ðŸ»â€ðŸ­","ðŸ‘¨ðŸ»â€ðŸ­","ðŸ‘©ðŸ»â€ðŸ’¼","ðŸ‘¨ðŸ»â€ðŸ’¼","ðŸ‘©ðŸ»â€ðŸ”¬","ðŸ‘¨ðŸ»â€ðŸ”¬","ðŸ‘©ðŸ»â€ðŸ’»","ðŸ‘¨ðŸ»â€ðŸ’»","ðŸ‘©ðŸ»â€ðŸŽ¤","ðŸ‘¨ðŸ»â€ðŸŽ¤","ðŸ‘©ðŸ»â€ðŸŽ¨","ðŸ‘¨ðŸ»â€ðŸŽ¨","ðŸ‘©ðŸ»â€âœˆï¸","ðŸ‘¨ðŸ»â€âœˆï¸","ðŸ‘©ðŸ»â€ðŸš€","ðŸ‘¨ðŸ»â€ðŸš€","ðŸ‘©ðŸ»â€ðŸš’","ðŸ‘¨ðŸ»â€ðŸš’","ðŸ§•ðŸ»","ðŸ‘°ðŸ»","ðŸ¤µðŸ»","ðŸ¤±ðŸ»","ðŸ¤°ðŸ»","ðŸ¦¸ðŸ»â€â™€ï¸","ðŸ¦¸ðŸ»â€â™‚ï¸","ðŸ¦¹ðŸ»â€â™€ï¸","ðŸ¦¹ðŸ»â€â™‚ï¸","ðŸ§™ðŸ»â€â™€ï¸","ðŸ§™ðŸ»â€â™‚ï¸","ðŸ§šðŸ»â€â™€ï¸","ðŸ§šðŸ»â€â™‚ï¸","ðŸ§›ðŸ»â€â™€ï¸","ðŸ§›ðŸ»â€â™‚ï¸","ðŸ§œðŸ»â€â™€ï¸","ðŸ§œðŸ»â€â™‚ï¸","ðŸ§ðŸ»â€â™€ï¸","ðŸ§ðŸ»â€â™‚ï¸","ðŸ§ŸðŸ»â€â™€ï¸","ðŸ§ŸðŸ»â€â™‚ï¸","ðŸ™ðŸ»â€â™€ï¸","ðŸ™ðŸ»â€â™‚ï¸","ðŸ™ŽðŸ»â€â™€ï¸","ðŸ™ŽðŸ»â€â™‚ï¸","ðŸ™…ðŸ»â€â™€ï¸","ðŸ™…ðŸ»â€â™‚ï¸","ðŸ™†ðŸ»â€â™€ï¸","ðŸ™†ðŸ»â€â™‚ï¸","ðŸ§ðŸ»â€â™€ï¸","ðŸ§ðŸ»â€â™‚ï¸","ðŸ’ðŸ»â€â™€ï¸","ðŸ’ðŸ»â€â™‚ï¸","ðŸ™‹ðŸ»â€â™€ï¸","ðŸ™‹ðŸ»â€â™‚ï¸","ðŸ™‡ðŸ»â€â™€ï¸","ðŸ™‡ðŸ»â€â™‚ï¸","ðŸ¤¦ðŸ»â€â™€ï¸","ðŸ¤¦ðŸ»â€â™‚ï¸","ðŸ¤·ðŸ»â€â™€ï¸","ðŸ¤·ðŸ»â€â™‚ï¸","ðŸ’†ðŸ»â€â™€ï¸","ðŸ’†ðŸ»â€â™‚ï¸","ðŸ’‡ðŸ»â€â™€ï¸","ðŸ’‡ðŸ»â€â™‚ï¸","ðŸ§–ðŸ»â€â™€ï¸","ðŸ§–ðŸ»â€â™‚ï¸","ðŸ¤¹ðŸ»â€â™€ï¸","ðŸ¤¹ðŸ»â€â™‚ï¸","ðŸ‘©ðŸ»â€ðŸ¦½","ðŸ‘¨ðŸ»â€ðŸ¦½","ðŸ‘©ðŸ»â€ðŸ¦¼","ðŸ‘¨ðŸ»â€ðŸ¦¼","ðŸ‘©ðŸ»â€ðŸ¦¯","ðŸ‘¨ðŸ»â€ðŸ¦¯","ðŸ§ŽðŸ»â€â™€ï¸","ðŸ§ŽðŸ»â€â™‚ï¸","ðŸ§ðŸ»â€â™€ï¸","ðŸ§ðŸ»â€â™‚ï¸","ðŸš¶ðŸ»â€â™€ï¸","ðŸš¶ðŸ»â€â™‚ï¸","ðŸƒðŸ»â€â™€ï¸","ðŸƒðŸ»â€â™‚ï¸","ðŸ’ƒðŸ»","ðŸ•ºðŸ»","ðŸ§—ðŸ»â€â™€ï¸","ðŸ§—ðŸ»â€â™‚ï¸","ðŸ§˜ðŸ»â€â™€ï¸","ðŸ§˜ðŸ»â€â™‚ï¸","ðŸ›€ðŸ»","ðŸ›ŒðŸ»","ðŸ•´ðŸ»","ðŸ‡ðŸ»","ðŸ‚ðŸ»","ðŸ’ªðŸ»","ðŸ¦µðŸ»","ðŸ¦¶ðŸ»","ðŸ‘‚ðŸ»","ðŸ¦»ðŸ»","ðŸ‘ƒðŸ»","ðŸ¤ðŸ»","ðŸ‘ˆðŸ»","ðŸ‘‰ðŸ»","â˜ðŸ»","ðŸ‘†ðŸ»","ðŸ‘‡ðŸ»","âœŒðŸ»","ðŸ¤žðŸ»","ðŸ––ðŸ»","ðŸ¤˜ðŸ»","ðŸ¤™ðŸ»","ðŸ–ðŸ»","âœ‹ðŸ»","ðŸ‘ŒðŸ»","ðŸ‘ðŸ»","ðŸ‘ŽðŸ»","âœŠðŸ»","ðŸ‘ŠðŸ»","ðŸ¤›ðŸ»","ðŸ¤œðŸ»","ðŸ¤šðŸ»","ðŸ‘‹ðŸ»","ðŸ¤ŸðŸ»","âœðŸ»","ðŸ‘ðŸ»","ðŸ‘ðŸ»","ðŸ™ŒðŸ»","ðŸ¤²ðŸ»","ðŸ™ðŸ»","ðŸ¤ðŸ»","ðŸ’…ðŸ»","ðŸ“Œ","â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ¤Ž","ðŸ–¤","ðŸ¤","ðŸ’”","â£","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ","ðŸ’Œ","ðŸ’¢","ðŸ’¥","ðŸ’¤","ðŸ’¦","ðŸ’¨","ðŸ’«"]},bt=new Map,xt=new Map,Et=new Map;let wt,St=!1,kt=!1,Lt=De.scrollTop,It=0,Ct={data:"",name:"",size:"",ext:""},Bt={data:"",name:"",size:"",ext:""},qt="",Tt={sender:"",message:"",type:"",id:""},_t={fileName:"",fileData:""},Rt={sender:"",message:"",type:"",id:""},At=null;const Ot=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);class Mt{constructor(e,t,s){this.target=e,this.callback=s,this.isHeld=!1,this.activeHoldTimeoutId=null,this.timeOut=t,["touchstart","mousedown"].forEach((e=>{try{this.target.addEventListener(e,this._onHoldStart.bind(this))}catch(e){console.log(e)}})),["touchmove","mousemove"].forEach((e=>{try{this.target.addEventListener(e,this._onHoldMove.bind(this))}catch(e){console.log(e)}})),["mouseup","touchend","mouseleave","mouseout","touchcancel"].forEach((e=>{try{this.target.addEventListener(e,this._onHoldEnd.bind(this))}catch(e){console.log(e)}}))}_onHoldStart(e){this.isHeld=!0,this.activeHoldTimeoutId=setTimeout((()=>{this.isHeld&&this.callback(e)}),this.timeOut)}_onHoldMove(){this.isHeld=!1}_onHoldEnd(){this.isHeld=!1,clearTimeout(this.activeHoldTimeoutId)}static applyTo(e,t,s){try{new Mt(e,t,s)}catch(e){console.log(e)}}}function Nt(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function $t(e=10){let t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=s.length;for(let o=0;o<e;o++)t+=s.charAt(Math.floor(Math.random()*n));return t}function Dt(e,t,s,n,o,a,i,r){i||(i={reply:!1,title:!1});let c="",l=De.querySelector(".message:last-child"),d="",u=Ft(e);if("text"===t)d=e.length>20?`${e.substring(0,20)} ...`:e,e=`<p class='text'>${e=function(e){return(t=e,e=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/fuck/g,"f**k")).replace(/shit/g,"s**t")).replace(/bitch/g,"b**t")).replace(/asshole/g,"a**hole")).replace(/dick/g,"d**k")).replace(/pussy/g,"p**s")).replace(/cock/g,"c**k")).replace(/baal/g,"b**l")).replace(/sex/g,"s*x")).replace(/Fuck/g,"F**k")).replace(/Shit/g,"S**t")).replace(/Bitch/g,"B**t")).replace(/Asshole/g,"A**hole")).replace(/Dick/g,"D**k")).replace(/Pussy/g,"P**s")).replace(/Cock/g,"C**k")).replace(/Baal/g,"B**l")).replace(/Sex/g,"S*x")).replaceAll("<","&#60;"),e.replaceAll(">","&#62;"),e.replaceAll('"',"&#34;"),e.replaceAll("'","&#39;"),e.replaceAll("&","&#38;"),(e=(e=(e=function(e){if(e.includes("http://")||e.includes("https://")||e.includes("www.")){let t=/(https?:\/\/|www\.)[^\s]+/g;return e.replace(t,(function(e){return/^(?:f|ht)tps?:\/\//.test(e)||(e="http://"+e),'<a href="'+e+'">'+e+"</a>"}))}return e}(e)).replaceAll(/```Â¶/g,"```")).replaceAll(/```([^`]+)```/g,"<code>$1</code>")).replaceAll("Â¶","<br>");var t}(e)}</p>`;else if("image"===t)d="Image",e=`<img class='image' src='${e}' alt='image' height='${r.height}' width='${r.width}' /><div class='sendingImage'> Uploading</div>`;else if("sticker"===t)d="Sticker",e=`<img class='sticker' src='/stickers/${e}.webp' alt='sticker' height='${r.height}' width='${r.width}' />`;else if("text"!=t&&"image"!=t&&"file"!=t&&"sticker"!=t)throw new Error("Invalid message type");n==lt&&(c+=" self"),l?.dataset?.uid!=n||u||"sticker"===t?c+=" start end":l?.dataset?.uid==n&&(i.reply||l?.classList.contains("emoji")||l?.classList.contains("sticker")?c+=" start":l?.classList.remove("end"),c+=" end"),u&&(l?.classList.add("end"),c+=" emoji"),"sticker"===t&&(l?.classList.add("end"),c+=" sticker"),i.reply||(c+=" noreply"),i.title&&c.includes("start")?c.includes("self")&&c.includes("noreply")&&(c+=" notitle"):c+=" notitle";let p,m,h,g,y=xt.get(n)?.name,f=xt.get(n)?.avatar;y==dt&&(y="You"),i.reply&&(g=xt.get(document.getElementById(a||"")?.dataset?.uid)?.name,g==dt&&(g="You"),g==y&&(g="self"),document.getElementById(a)||(o={data:"Message is not available on this device",type:"text"}),"text"===o.type||"file"===o.type?(m=o.data,h="message"):"image"===o.type?(m=document.getElementById(a)?.querySelector(".messageMain .image").outerHTML.replace('class="image"','class="image imageReply"'),h="image"):"sticker"===o.type&&(m=document.getElementById(a)?.querySelector(".messageMain .sticker").outerHTML.replace('class="sticker"','class="sticker imageReply"'),h="image")),"file"===t?(d="File",p=Ae.render(gt,{classList:c,avatar:`<img src='/images/avatars/${f}(custom).png' width='30px' height='30px' alt='avatar' />`,messageId:s,uid:n,type:t,repId:a,title:i.reply?`<i class="fa-solid fa-reply"></i>${y} replied to ${g||"a message"}`:y,data:e,fileName:r.name,fileSize:r.size,ext:r.ext,replyMsg:"file"===document.getElementById(a)?.dataset?.type?`<i class="fa-solid fa-paperclip"></i> ${m}`:m,replyFor:h,time:Pt()})):p=Ae.render(ht,{classList:c,avatar:`<img src='/images/avatars/${f}(custom).png' width='30px' height='30px' alt='avatar' />`,messageId:s,uid:n,type:t,repId:a,title:i.reply?`<i class="fa-solid fa-reply"></i>${y} replied to ${g||"a message"}`:y,message:e,replyMsg:"file"===document.getElementById(a)?.dataset?.type?`<i class="fa-solid fa-paperclip"></i> ${m}`:m,replyFor:h,time:Pt()}),At=s,document.hasFocus()&&Ne.emit("seen",{userId:lt,messageId:At,avatar:ut});const v=document.createDocumentFragment();v.append(document.createRange().createContextualFragment(p)),De.append(v),"image"!=o.type&&"sticker"!=o.type||document.getElementById(s).querySelector(".messageReply")?.classList.add("imageReply"),Lt=De.scrollTop,ss(l?.id),is(xt.get(n)?.avatar,d)}function Pt(){return new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric",hour12:!0}).format(new Date)}function Ft(e){if(/^([\uD800-\uDBFF][\uDC00-\uDFFF])+$/.test(e))return e=e.replace(/\s/g,""),!0}function jt(e=!0){const t=document.getElementById("focus_glass");t.classList.remove("backdrop"),t.classList.add("active"),1==e&&t.classList.add("backdrop")}function Ut(){const e=document.getElementById("focus_glass");e.classList.remove("active"),e.classList.remove("backdrop")}function zt(e){let t=e.target;(t.classList.contains("close_area")||"optionsContainer"==t.id)&&Vt(),function(e){let t=e.target?.classList[0];t&&Yt(t)}(e)}function Ht(){try{console.log("Saving image");let e=document.createElement("a");e.href=document.querySelector("#lightbox__image img").src,e.download=`poketab-${Date.now()}`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}catch(e){console.log(e)}}function Yt(e){if(vt.primary.includes(e)||vt.expanded.includes(e)){let t=Tt.id;localStorage.setItem("lastReact",e),Ne.emit("react",e,t,lt),Vt()}}function Vt(){let e=document.getElementById("optionsContainerWrapper");document.querySelector(".reactOptionsWrapper").dataset.closed="false",bs(),e.classList.remove("active"),document.getElementById("sidebar_wrapper").classList.remove("active"),document.querySelector(".themeChooser").classList.remove("active"),setTimeout((()=>{ze.style.display="none",He.style.display="none",Ye.style.display="none",e.style.display="none"}),20),Ut(),document.querySelector(".reactorContainerWrapper").classList.remove("active"),e.removeEventListener("click",zt)}Ot&&Mt.applyTo(De,300,(e=>{"true"==e.target.closest(".message").dataset.deleted||as(e)})),Ot||De.addEventListener("contextmenu",(e=>{if(e.preventDefault(),e.stopPropagation(),3==e.which){let t=e.target.closest(".message")??!1,s="true"==e.target.closest(".message")?.dataset.deleted;t&&!s&&as(e)}})),function(){let e=document.getElementById("reactOptions");for(let t=0;t<vt.primary.length-1;t++){const s=document.createElement("div");s.classList.add(`${vt.primary[t]}`),s.classList.add("react-emoji"),s.textContent=vt.primary[t],e.insertBefore(s,e.lastElementChild)}let t=localStorage.getItem("lastReact")||vt.last;vt.primary.includes(t)&&(t="ðŸŒ»");const s=document.createElement("div");s.classList.add(`${t}`),s.classList.add("react-emoji"),s.classList.add("last"),s.textContent=t,e.insertBefore(s,e.lastElementChild);let n=document.querySelector(".moreReacts");for(let e=0;e<vt.expanded.length;e++){const t=document.createElement("div");t.classList.add("react-emoji"),t.classList.add(`${vt.expanded[e]}`),t.textContent=vt.expanded[e],n.appendChild(t)}}(),yt=localStorage.getItem("theme"),null==yt&&(yt="blue",localStorage.setItem("theme",yt)),document.documentElement.style.setProperty("--pattern",`url('../images/backgrounds/${yt}_w.webp')`),document.documentElement.style.setProperty("--secondary-dark",ft[yt].secondary),document.documentElement.style.setProperty("--msg-get",ft[yt].msg_get),document.documentElement.style.setProperty("--msg-get-reply",ft[yt].msg_get_reply),document.documentElement.style.setProperty("--msg-send",ft[yt].msg_send),document.documentElement.style.setProperty("--msg-send-reply",ft[yt].msg_send_reply),document.querySelector('meta[name="theme-color"]').setAttribute("content",ft[yt].secondary),window.addEventListener("focus",(()=>{null!=wt&&wt.close(),Ne.emit("seen",{userId:lt,messageId:At,avatar:ut})}));let Xt,Wt,Kt,Gt=null,Jt=null,Zt=0,Qt=0;function es(){Vt(),is(),Ue.focus(),Rt=Object.assign({},Tt),"image"==Rt.type||"sticker"==Rt.type?Fe.querySelector(".replyData").appendChild(Rt.message):"file"==Rt.type?Fe.querySelector(".replyData").innerHTML=`<i class="fa-solid fa-paperclip"></i>${Rt.message?.substring(0,50)}`:Fe.querySelector(".replyData").textContent=Rt.message?.substring(0,50),Fe.querySelector(".username").textContent=Rt.sender,Fe.style.display="flex",setTimeout((()=>{Fe.classList.add("active")}),10)}function ts(){Fe.classList.remove("active"),Fe.style.display="none",Fe.querySelector(".replyData").textContent="",Fe.querySelector(".username").textContent="",Lt=De.scrollTop,ns()}function ss(e){try{if(e){let t=document.getElementById(e),s=t?.nextElementSibling;t.classList.contains("react")?t.querySelector(".seenBy").hasChildNodes()?(t.style.marginBottom="0px",t.querySelectorAll(".seenBy img").forEach((e=>e.style.marginTop="12px"))):t.style.marginBottom="12px":(t.style.marginBottom="0px",t.querySelector(".seenBy").hasChildNodes()&&t.querySelectorAll(".seenBy img").forEach((e=>e.style.marginTop="0px"))),null!=t&&null!=s&&t?.dataset.uid===s?.dataset.uid&&(t.dataset.uid==lt?Math.abs(t.querySelector(".messageContainer").getBoundingClientRect().bottom-s.querySelector(".messageContainer").getBoundingClientRect().top)>2?(t.querySelector(".messageMain > *").style.borderBottomRightRadius="15px",s.querySelector(".messageMain > *").style.borderTopRightRadius="15px"):t.classList.contains("end")||s.classList.contains("start")||(t.querySelector(".messageMain > *").style.borderBottomRightRadius="3px",s.querySelector(".messageMain > *").style.borderTopRightRadius="3px"):Math.abs(t.querySelector(".messageContainer").getBoundingClientRect().bottom-s.querySelector(".messageContainer").getBoundingClientRect().top)>2?(t.querySelector(".messageMain > *").style.borderBottomLeftRadius="15px",s.querySelector(".messageMain > *").style.borderTopLeftRadius="15px"):t.classList.contains("end")||s.classList.contains("start")||(t.querySelector(".messageMain > *").style.borderBottomLeftRadius="3px",s.querySelector(".messageMain > *").style.borderTopLeftRadius="3px"))}}catch(e){console.log(e)}}function ns(){Tt.sender="",Tt.message="",Tt.type="",Tt.id=""}function os(){Rt.sender="",Rt.message="",Rt.type="",Rt.id=""}function as(e,t=!0){let s,n=!!e.target.closest(".message").classList.contains("self");if(e.target.closest(".messageMain")?.querySelector(".text"))s="text",Tt.sender=xt.get(e.target.closest(".message")?.dataset?.uid).name,Tt.sender==dt&&(Tt.sender="You"),Tt.message=e.target.closest(".messageMain").querySelector(".text").innerText,Tt.type=s,Tt.id=e.target?.closest(".message")?.id;else if(e.target.classList.contains("image")&&!e.target.classList.contains("imageReply")){for(s="image";document.querySelector("#lightbox__image").firstChild;)document.querySelector("#lightbox__image").removeChild(document.querySelector("#lightbox__image").firstChild);const t=document.createDocumentFragment(),n=document.createElement("img");n.src=e.target.closest(".messageMain")?.querySelector(".image").src,n.alt="Image",t.append(n),document.querySelector("#lightbox__image").append(t),Tt.sender=xt.get(e.target.closest(".message")?.dataset?.uid).name,Tt.sender==dt&&(Tt.sender="You");let o=e.target.closest(".messageMain").querySelector(".image").cloneNode(!0);Tt.message=o,Tt.type=s,Tt.id=e.target?.closest(".message")?.id}else if(e.target.closest(".messageMain")?.querySelector(".file"))s="file",Tt.sender=xt.get(e.target.closest(".message")?.dataset?.uid).name,Tt.sender==dt&&(Tt.sender="You"),_t.fileName=e.target.closest(".messageMain").querySelector(".fileName").textContent,_t.fileData=e.target.closest(".messageMain").querySelector(".file").dataset.data,Tt.message=_t.fileName,Tt.type=s,Tt.id=e.target?.closest(".message")?.id;else if(e.target.closest(".messageMain")?.querySelector(".sticker")){s="sticker",Tt.sender=xt.get(e.target.closest(".message")?.dataset?.uid).name,Tt.sender==dt&&(Tt.sender="You");let t=e.target.closest(".messageMain").querySelector(".sticker").cloneNode(!0);Tt.message=t,Tt.type=s,Tt.id=e.target?.closest(".message")?.id}"text"!==s&&"image"!==s&&"file"!==s&&"sticker"!==s||!t||function(e,t,s){if(document.querySelector(".reactorContainerWrapper").classList.remove("active"),document.querySelectorAll("#reactOptions div").forEach((e=>e.style.background="none")),document.querySelectorAll(".moreReacts div").forEach((e=>e.style.background="none")),document.getElementById("showMoreReactBtn").style.background="none",s.classList.contains("imageReply"))return;if("text"===e)ze.style.display="flex";else if("image"===e){if("true"!=s.closest(".message")?.dataset.downloaded)return s.closest(".message")?.dataset.uid==lt?us("Not sent yet"):us("Not downloaded yet"),void console.log("%cNot availabe yet","color: red");He.style.display="flex"}else if("file"===e){if("true"!=s.closest(".message")?.dataset.downloaded)return s.closest(".message")?.dataset.uid==lt?us("Not sent yet"):us("Not downloaded yet"),void console.log("%cNot availabe yet","color: red");He.style.display="flex"}if(Ye.style.display=!0===t?"flex":"none",Array.from(s?.closest(".message")?.querySelectorAll(".reactedUsers .list")).reduce(((e,t)=>e||t.dataset.uid==lt),!1)){let e=s?.closest(".message")?.querySelector(`.reactedUsers [data-uid="${lt}"]`)?.textContent;if(vt.primary.includes(e)&&(document.querySelector(`#reactOptions .${e}`).style.background=ft[yt].secondary),vt.expanded.includes(e)&&(document.querySelector(`.moreReacts .${e}`).style.background=ft[yt].secondary),vt.expanded.includes(e)&&!vt.primary.includes(e)){const t=document.querySelector("#reactOptions").lastElementChild.previousElementSibling;t.style.background=ft[yt].secondary,t.classList.replace(t.classList[0],e),t.textContent=e,vt.last=e}}let n=document.getElementById("optionsContainerWrapper");n.style.display="grid",setTimeout((()=>{n.classList.add("active"),jt(!1),n.addEventListener("click",zt)}),20)}(s,n,e.target),navigator.vibrate&&navigator.vibrate(50)}function is(e=null,t=""){kt?t.length>0&&null!=e&&(document.querySelector(".newmessagepopup img").style.display="block",document.querySelector(".newmessagepopup .msg").style.display="block",document.querySelector(".newmessagepopup .downarrow").style.display="none",document.querySelector(".newmessagepopup img").src=`/images/avatars/${e}(custom).png`,document.querySelector(".newmessagepopup .msg").textContent=t,document.querySelector(".newmessagepopup").classList.add("active")):setTimeout((()=>{let e=document.getElementById("messages");e.scrollTo(0,e.scrollHeight),Lt=e.scrollTop}),20)}function rs(){document.querySelector(".newmessagepopup").classList.remove("active"),document.querySelector(".newmessagepopup img").style.display="none",document.querySelector(".newmessagepopup .downarrow").style.display="none"}function cs(e){if(e.size>0){const t=Array.from(e.values());let s="";return t.length>=1&&(s=1==t.length?t[0]:2==t.length?`${t[0]} and ${t[1]}`:3==t.length?`${t[0]}, ${t[1]} and ${t[2]}`:`${t[0]}, ${t[1]}, ${t[2]} and ${t.length-3} other${t.length-3>1?"s":""}`),s+=(t.length>1?" are ":" is ")+" typing...",s}return""}function ls(){Ue.style.height="auto",Ue.style.height=Ue.scrollHeight+"px"}function ds(e){null==e&&(e=Tt.message),navigator.clipboard?(navigator.clipboard.writeText(e),us("Copied to clipboard")):us("This browser does't support clipboard access")}function us(e){document.querySelector(".popup-message").textContent=e,document.querySelector(".popup-message").classList.add("active"),Xt&&clearTimeout(Xt),Xt=setTimeout((function(){document.querySelector(".popup-message").classList.remove("active"),Xt=void 0}),1e3)}De.addEventListener("touchstart",(e=>{e.target.closest(".message")&&(Gt=e.touches[0].clientX,Jt=e.touches[0].clientY)})),De.addEventListener("touchmove",(e=>{try{const t=e.target.closest(".message");if(e.target.classList.contains("messageMain")||e.target.closest(".messageMain")&&Qt<10&&"true"!=t.dataset.deleted&&t.classList.contains("delevered")){Zt=Gt-e.touches[0].clientX,Qt=Jt-e.touches[0].clientY;const s=t.querySelector(".messageContainer");t.classList.contains("self")?(Zt>50?(Zt=50,s.dataset.replyTrigger="true"):s.dataset.replyTrigger="false",Zt=Zt<0?0:Zt,s.style.transform=`translateX(${-Zt}px)`):(Zt<-50?(Zt=-50,s.dataset.replyTrigger="true"):s.dataset.replyTrigger="false",Zt=Zt>0?0:Zt,s.style.transform=`translateX(${-Zt}px)`)}}catch(e){console.log(e),us(e)}})),De.addEventListener("touchend",(e=>{try{if(e.target.closest(".message")){Zt=0,Qt=0;const t=e.target.closest(".message");if(!t)return;{const s=t.querySelector(".messageContainer");s.style.transform=`translateX(-${Zt}px)`,"true"===s.dataset.replyTrigger&&(s.dataset.replyTrigger="false",as(e,!1),es())}}}catch(e){console.log(e),us(e)}})),Wt=localStorage.getItem("selectedStickerGroup")||Oe.Stickers[0].name;const ps=document.getElementById("selectStickerGroup");let ms,hs,gs,ys;function fs(){Kt=Oe.Stickers.find((e=>e.name==Wt)).count;const e=document.getElementById("stickers");e.innerHTML="";for(let t=1;t<=Kt;t++){const s=document.createElement("img");s.src=`/stickers/${Wt}/static/${t}-mini.webp`,s.alt=`${Wt}-${t}`,s.dataset.name=`${Wt}/animated/${t}`,s.classList.add("stickerpack","clickable"),e.append(s)}document.querySelector('.names > img[data-name="'+Wt+'"]').dataset.selected="true"}function vs(){Ut(),document.getElementById("stickersPanel").classList.remove("active"),setTimeout((()=>{document.getElementById("stickersPanel").style.display="none"}),4)}function bs(){let e=document.querySelector(".reactOptionsWrapper");"true"==e.dataset.closed?(e.dataset.closed="false",document.querySelector(".moreReactsContainer").classList.add("active")):(e.dataset.closed="true",document.querySelector(".moreReactsContainer").classList.remove("active"))}function xs(e=null){let t=e||at.files[0];if(t.size>15728640)return void us("File size too large");for(document.getElementById("previewImage").querySelector("#imageSend").style.display="none";document.getElementById("selectedImage").firstChild;)document.getElementById("selectedImage").removeChild(document.getElementById("selectedImage").firstChild);const s=document.createElement("span");s.classList.add("load"),s.style.color=ft[yt].secondary;const n=document.createElement("i");n.classList.add("fa-solid","fa-gear","fa-spin"),s.append(n),s.append("Reading binary data&nbsp;"),document.getElementById("selectedImage").append(s),document.getElementById("previewImage")?.classList?.add("active");let o=new FileReader;o.readAsDataURL(t),o.onload=e=>{let s=e.target.result;for(Ct.data=s,Ct.name=t.name,Ct.ext=t.type.split("/")[1],Ct.size=t.size,qt="image";document.getElementById("selectedImage").firstChild;)document.getElementById("selectedImage").removeChild(document.getElementById("selectedImage").firstChild);const n=document.createRange().createContextualFragment(`<img src="${s}" alt="image" class="image-message" />`);document.getElementById("selectedImage").append(n),document.getElementById("previewImage").querySelector("#imageSend").style.display="flex"},at.value="",it.value=""}function Es(e=null){for(document.getElementById("previewImage").querySelector("#imageSend").style.display="none";document.getElementById("selectedImage").firstChild;)document.getElementById("selectedImage").removeChild(document.getElementById("selectedImage").firstChild);const t=document.createElement("span");t.classList.add("load"),t.style.color=ft[yt].secondary;const s=document.createElement("i");s.classList.add("fa-solid","fa-gear","fa-spin"),t.append(s),t.append("Reading binary data&nbsp;"),document.getElementById("selectedImage").append(t),document.getElementById("previewImage")?.classList?.add("active");let n=e||it.files[0],o=n.name,a=n.size;if(a<1024?a+="b":a=a<1048576?(a/1024).toFixed(1)+"kb":(a/1048576).toFixed(1)+"mb",n.size>15e6){for(us("File size must be less than 15 mb"),document.getElementById("previewImage")?.classList.remove("active");document.getElementById("selectedImage").firstChild;)document.getElementById("selectedImage").removeChild(document.getElementById("selectedImage").firstChild);return}let i=new FileReader;i.readAsDataURL(n),i.onload=e=>{let t=e.target.result;Bt.data=t,Bt.name=o,Bt.size=a;let s=ws[Bt.data.substring(0,Bt.data.indexOf(","))]||"file";for(Bt.ext=s,qt="file";document.getElementById("selectedImage").firstChild;)document.getElementById("selectedImage").removeChild(document.getElementById("selectedImage").firstChild);Bt.name=Bt.name.split(".")[0]+"."+s,o=Bt.name;const n=document.createRange().createContextualFragment(`<div class='file_preview'><i class="fa-regular fa-file-lines"></i><div>File: ${o.length>=25?o.substring(0,10)+"..."+o.substring(o.length-10,o.length):o}</div><div>Size: ${a}</div></div>`);document.getElementById("selectedImage").append(n),document.getElementById("previewImage").querySelector("#imageSend").style.display="flex"},at.value="",it.value=""}document.getElementById("focus_glass").addEventListener("click",(()=>{Ut(),vs()})),document.querySelector(".fa-angle-left").addEventListener("click",(()=>{ps.scrollTo({left:ps.scrollLeft-60,behavior:"smooth"})})),document.querySelector(".fa-angle-right").addEventListener("click",(()=>{ps.scrollTo({left:ps.scrollLeft+60,behavior:"smooth"})})),document.querySelector(".stickerBtn").addEventListener("click",(()=>{document.getElementById("stickersPanel").style.display="flex",setTimeout((()=>{jt(!1),document.getElementById("stickersPanel").classList.add("active"),document.getElementById("selectStickerGroup").querySelector(`img[data-name="${Wt}"]`).scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}),4)})),document.getElementById("selectStickerGroup").addEventListener("click",(e=>{"IMG"===e.target.tagName&&(document.getElementById("stickers").innerHTML='Loading&nbsp;<i class="fa-solid fa-circle-notch fa-spin" style="color: var(--secondary-dark)"></i>',document.getElementById("selectStickerGroup").querySelectorAll(".stickerName").forEach((e=>{e.dataset.selected="false"})),Wt=e.target.dataset.name,localStorage.setItem("selectedStickerGroup",Wt),Kt=Oe.Stickers.find((e=>e.name===Wt)).count,fs())})),document.getElementById("stickers").addEventListener("click",(e=>{if("IMG"===e.target.tagName){let t=$t();nt.play(),kt=!1,is(),Dt(e.target.dataset.name,"sticker",t,lt,{data:Rt?.message,type:Rt?.type},Rt?.id,{reply:!!Rt.message,title:!!(Rt.message||mt>2)},{}),Ne.emit("message",e.target.dataset.name,"sticker",lt,{data:Rt?.message,type:Rt?.type},Rt?.id,{reply:!!Rt.message,title:!!(Rt.message||mt>2)},(function(e){Ge.play(),document.getElementById(t).classList.add("delevered"),document.getElementById(t).id=e,At=e,document.hasFocus()&&Ne.emit("seen",{userId:lt,messageId:At,avatar:ut})})),ns(),os(),ts(),vs()}})),document.getElementById("more").addEventListener("click",(()=>{document.getElementById("sidebar_wrapper").classList.add("active"),jt()})),document.querySelectorAll(".keyCopy").forEach((e=>{e.addEventListener("click",(e=>{let t=e.target.closest(".keyCopy").querySelector(".fa-clone");t.classList.replace("fa-clone","fa-check"),t.classList.replace("fa-regular","fa-solid"),t.style.color="var(--secondary-dark)",ms&&clearTimeout(ms),ms=setTimeout((()=>{t.classList.replace("fa-check","fa-clone"),t.classList.replace("fa-solid","fa-regular"),t.style.color="var(--secondary-dark)",ms=void 0}),1e3),ds(pt)}))})),document.getElementById("invite").addEventListener("click",(async()=>{try{if(!navigator.share)return void us("Sharing in not supported by this browser");await navigator.share({title:"Poketab Messanger",text:"Join chat!",url:`https://${window.location.host}/join/${pt}`}),us("Shared!")}catch(e){us(`${e}`)}})),document.querySelector(".theme_option").addEventListener("click",(()=>{Vt(),yt&&(document.querySelector(".themeChooser").querySelectorAll(".theme").forEach((e=>{e.querySelector("img").style.border=""})),document.querySelector(`.themeChooser #${yt}`).querySelector("img").style.border="2px solid var(--secondary-dark)"),jt(),document.querySelector(".themeChooser").classList.add("active")})),document.querySelector(".themeChooser").addEventListener("click",(()=>{document.querySelector(".themeChooser").classList.remove("active"),Vt()})),document.querySelectorAll(".theme").forEach((e=>{e.addEventListener("click",(e=>{yt=e.target.closest("li").id,localStorage.setItem("theme",yt),console.log(`Theme changed to ${yt}`),document.documentElement.style.setProperty("--pattern",`url('../images/backgrounds/${yt}_w.webp')`),document.documentElement.style.setProperty("--secondary-dark",ft[yt].secondary),document.documentElement.style.setProperty("--msg-get",ft[yt].msg_get),document.documentElement.style.setProperty("--msg-get-reply",ft[yt].msg_get_reply),document.documentElement.style.setProperty("--msg-send",ft[yt].msg_send),document.documentElement.style.setProperty("--msg-send-reply",ft[yt].msg_send_reply),document.querySelector(".themeChooser").classList.remove("active"),document.querySelector('meta[name="theme-color"]').setAttribute("content",ft[yt].secondary),Vt()}))})),We.addEventListener("click",(()=>{bs()})),document.querySelector(".moreReacts").addEventListener("click",(e=>{let t=e.target;t.classList.contains("react-emoji")&&(Yt(t.textContent),Vt())})),De.addEventListener("scroll",(()=>{It=De.scrollTop;let e=Lt-It;It<=Lt?(e>=50&&(kt=!0),0==e&&(document.querySelector(".newmessagepopup").classList.remove("active"),kt=!1)):(Lt=It,rs(),kt=!1),e>=300&&(document.querySelector(".newmessagepopup img").style.display="none",document.querySelector(".newmessagepopup .msg").style.display="none",document.querySelector(".newmessagepopup .downarrow").style.display="block",document.querySelector(".newmessagepopup").classList.add("active"))})),Ue.addEventListener("input",(function(){ls(),rt&&(clearTimeout(rt),rt=void 0),ct||(ct=!0,Ne.emit("typing")),rt=setTimeout((function(){ct=!1,Ne.emit("stoptyping")}),1e3)})),document.querySelector(".newmessagepopup").addEventListener("click",(function(){kt=!1,is(),rs()})),document.getElementById("logout").addEventListener("click",(()=>{document.getElementById("preload").querySelector(".text").textContent="Logging out",document.getElementById("preload").style.display="flex",window.location.href="/"})),Fe.querySelector(".close").addEventListener("click",(()=>{ns(),os(),ts()})),document.addEventListener("contextmenu",(e=>e.preventDefault())),je.addEventListener("click",(()=>{for(document.getElementById("lightbox").classList.remove("active");document.getElementById("lightbox__image").firstChild;)document.getElementById("lightbox__image").removeChild(document.getElementById("lightbox__image").firstChild)})),Ue.addEventListener("focus",(function(){is()})),Ue.addEventListener("blur",(()=>{St&&Ue.focus()})),document.querySelector(".close_area").addEventListener("click",(()=>{document.getElementById("sidebar_wrapper").classList.remove("active"),Vt()})),document.getElementById("attmain").addEventListener("click",(()=>{document.getElementById("attmain").classList.remove("active"),setTimeout((()=>{document.getElementById("attmain").style.display="none"}),4)})),document.getElementById("attachment").addEventListener("click",(()=>{document.getElementById("attmain").style.display="flex",setTimeout((()=>{document.getElementById("attmain").classList.add("active")}),4)})),document.querySelector(".reactOptionsWrapper").addEventListener("click",(e=>{e.target.classList.contains("reactOptionsWrapper")&&Vt()})),De.addEventListener("click",(e=>{try{if(e.target?.closest(".message")?.contains(e.target)&&!e.target?.classList.contains("message")&&(e.target?.closest(".message")?.querySelector(".messageTime")?.classList?.add("active"),hs&&clearTimeout(hs),hs=setTimeout((()=>{e.target?.closest(".message")?.querySelector(".messageTime")?.classList?.remove("active"),hs=void 0}),1500)),e.target?.classList?.contains("image")&&!e.target?.classList?.contains("imageReply")){if(e.preventDefault(),e.stopPropagation(),"true"!=e.target.closest(".message")?.dataset.downloaded)return e.target.closest(".message")?.dataset.uid==lt?us("Not sent yet"):us("Not downloaded yet"),void console.log("%cNot availabe yet","color: blue");for(;document.getElementById("lightbox__image").firstChild;)document.getElementById("lightbox__image").removeChild(document.getElementById("lightbox__image").firstChild);const t=document.createRange().createContextualFragment(`<img src=${e.target?.src} class='lb'>`);document.getElementById("lightbox__image").append(t),function(e,t){let s=(t=t||{}).minScale?t.minScale:.4,n=t.maxScale?t.maxScale:3,o=t.increment?t.increment:.05,a=!!t.liner&&t.liner;new Me(e,s,n,o,a)}(document.getElementById("lightbox__image").querySelector("img")),document.getElementById("lightbox").classList.add("active")}else if(e.target?.classList?.contains("reactsOfMessage")||e.target?.parentNode?.classList?.contains("reactsOfMessage")){let t=e.target?.closest(".message")?.querySelectorAll(".reactedUsers .list"),s=document.querySelector(".reactorContainer ul");for(;s.firstChild;)s.removeChild(s.firstChild);t.length>0&&t.forEach((e=>{let t=xt.get(e.dataset.uid).avatar,n=xt.get(e.dataset.uid).name;if(n==dt&&(n="You"),e.dataset.uid==lt){const o=document.createRange().createContextualFragment(`<li><img src='/images/avatars/${t}(custom).png' height='30px' width='30px'><span class='uname'>${n}</span><span class='r'>${e.textContent}</span></li>`);s.prepend(o)}else{const o=document.createRange().createContextualFragment(`<li><img src='/images/avatars/${t}(custom).png' height='30px' width='30px'><span class='uname'>${n}</span><span class='r'>${e.textContent}</span></li>`);s.append(o)}})),Vt(),document.querySelector(".reactorContainerWrapper").classList.add("active"),jt(!1)}else if(e.target?.closest(".messageReply")||e.target?.closest(".imageReply"))if("true"!=document.getElementById(e.target.closest(".messageReply").dataset.repid).dataset.deleted)try{let t=e.target.closest(".messageReply")?.dataset.repid;document.querySelectorAll(".message").forEach((e=>{e.id!=t&&(e.style.filter="brightness(0.7)")})),gs&&clearTimeout(gs),gs=setTimeout((()=>{document.querySelectorAll(".message").forEach((e=>{e.style.filter=""})),gs=void 0}),1e3),ys&&clearTimeout(ys),ys=setTimeout((()=>{document.getElementById(t).scrollIntoView({behavior:"smooth",block:"start"}),ys=void 0}),4)}catch(e){us("Deleted message")}else us("Deleted message");else Vt()}catch(e){console.log("Message does not exist")}})),document.querySelector(".reactorContainerWrapper").addEventListener("click",(e=>{e.target.classList.contains("reactorContainerWrapper")&&Vt()})),window.addEventListener("resize",(()=>{Nt();let e=kt;setTimeout((()=>{kt=!1,is()}),4),kt=e,St=Pe>window.innerHeight})),Ve.addEventListener("click",es),ze.addEventListener("click",(()=>{Vt(),ds(null)})),He.addEventListener("click",(function(){"image"===Tt.type?(document.querySelector("#lightbox__image img").src=Tt.message.src,Ht()):function(){let e=_t.fileData,t=_t.fileName,s=document.createElement("a");s.href=e,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s)}()})),Ye.addEventListener("click",(()=>{let e=document.getElementById(Tt.id)?.dataset?.uid;e&&(Vt(),Ne.emit("deletemessage",Tt.id,e,dt,lt))})),at.addEventListener("change",(()=>{xs()})),it.addEventListener("change",(()=>{Es()}));const ws={"data:image/jpeg;base64":"jpg","data:image/png;base64":"png","data:image/gif;base64":"gif","data:image/bmp;base64":"bmp","data:image/webp;base64":"webp","data:image/tiff;base64":"tiff","data:image/x-icon;base64":"ico","data:application/pdf;base64":"pdf","data:application/zip;base64":"zip","data:application/x-rar-compressed;base64":"rar","data:application/x-7z-compressed;base64":"7z","data:application/x-tar;base64":"tar","data:application/x-bzip;base64":"bz","data:application/x-bzip2;base64":"bz2","data:application/x-gzip;base64":"gz","data:application/x-xz;base64":"xz","data:audio/mpeg;base64":"mp3","data:audio/ogg;base64":"ogg","data:audio/wav;base64":"wav","data:audio/x-wav;base64":"wav","data:audio/x-pn-wav;base64":"wav","data:audio/x-ms-wma;base64":"wma","data:audio/x-ms-wax;base64":"wax","data:audio/x-aiff;base64":"aif","data:audio/x-mpegurl;base64":"m3u","data:audio/x-scpls;base64":"pls","data:audio/x-mpeg;base64":"mp2","data:audio/x-m4a;base64":"m4a","data:audio/x-realaudio;base64":"ra","data:video/mpeg;base64":"mpeg","data:video/mp4;base64":"mp4","data:video/quicktime;base64":"mov","data:video/x-msvideo;base64":"avi","data:video/x-ms-wmv;base64":"wmv","data:video/x-ms-asf;base64":"asf","data:video/x-flv;base64":"flv","data:video/x-m4v;base64":"m4v","data:video/x-matroska;base64":"mkv","data:video/x-mng;base64":"mng","data:text/plain;base64":"txt","data:text/html;base64":"html","data:text/css;base64":"css","data:text/javascript;base64":"js","data:text/xml;base64":"xml","data:text/csv;base64":"csv","data:text/x-csv;base64":"csv","data:text/x-c;base64":"c","data:text/x-c++src;base64":"cpp","data:text/x-c++hdr;base64":"hpp","data:text/x-java;base64":"java","data:text/x-python;base64":"py","data:text/x-php;base64":"php","data:text/x-ruby;base64":"rb","data:text/x-sql;base64":"sql","data:text/x-csharp;base64":"cs","data:application/vnd.ms-excel;base64":"xls","data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64":"xlsx","data:application/vnd.ms-powerpoint;base64":"ppt","data:application/vnd.openxmlformats-officedocument.presentationml.presentation;base64":"pptx","data:application/msword;base64":"doc","data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64":"docx","data:application/vnd.oasis.opendocument.text;base64":"odt","data:application/vnd.oasis.opendocument.spreadsheet;base64":"ods","data:application/vnd.oasis.opendocument.presentation;base64":"odp","data:application/vnd.oasis.opendocument.graphics;base64":"odg","data:application/vnd.oasis.opendocument.chart;base64":"odc","data:application/vnd.oasis.opendocument.formula;base64":"odf","data:application/x-msdownload;base64":"exe","data:application/x-msi;base64":"msi","data:application/x-ms-shortcut;base64":"lnk","data:application/x-ms-wmd;base64":"wmd","data:application/x-ms-wmz;base64":"wmz","data:application/x-ms-xbap;base64":"xbap","data:application/x-msaccess;base64":"mdb","data:application/x-msbinder;base64":"obd","data:application/x-mscardfile;base64":"crd","data:application/x-msclip;base64":"clp","data:application/x-msmediaview;base64":"mvb","data:application/x-apple-diskimage;base64":"dmg","data:application/x-apple-keynote;base64":"key","data:application/x-apple-pages;base64":"pages","data:application/x-apple-numbers;base64":"numbers","data:application/x-apple-systemprofiler;base64":"spf","data:application/x-apple-diskcopy;base64":"dmg","data:application/x-debian-package;base64":"deb","data:application/x-redhat-package-manager;base64":"rpm","data:application/x-compressed-tar;base64":"tar.gz","data:application/vnd.android.package-archive;base64":"apk","data:application/x-itunes-ipa;base64":"ipa","data:application/x-itunes-ipg;base64":"ipg","data:application/x-itunes-ipsw;base64":"ipsw","data:application/x-itunes-ite;base64":"ite","data:application/x-itunes-itlp;base64":"itlp","data:application/x-itunes-itms;base64":"itms","data:application/x-itunes-itpc;base64":"itpc","data:application/x-silverlight-app;base64":"xap"};let Ss,ks;function Ls(e,t){let s=e.split(","),n=window.atob(s[1]),o=n.length,a=new Uint8Array(o);for(;o--;)a[o]=n.charCodeAt(o);return new File([a],t+".qml")}function Is(e,t,s){"Notification"in window&&"granted"===Notification.permission?document.hasFocus()||(document.querySelector("title").text=`${t} messaged`,null==ks&&(ks=setTimeout((()=>{document.querySelector("title").text="Inbox",ks=void 0}),3e3)),wt=new Notification(t,{body:"Text"==e.type?e.data:e.type,icon:`/images/avatars/${s}(custom).png`,tag:t})):"denied"!==Notification.permission&&Notification.requestPermission().then((n=>{"granted"===n&&(document.hasFocus()||(document.querySelector("title").text=`${t} messaged`,null==ks&&(ks=setTimeout((()=>{document.querySelector("title").text="Inbox",ks=void 0}),3e3)),wt=new Notification(t,{body:"Text"==e.type?e.data:e.type,icon:`/images/avatars/${s}(custom).png`,tag:t})))}))}window.addEventListener("dragover",(e=>{e.preventDefault(),e.stopPropagation(),Xe.classList.add("active"),e.target.classList.contains("fileDropZoneContent")?(document.querySelector(".fileDropZoneContent").style.color=ft[yt].secondary,Ss&&clearTimeout(Ss)):(document.querySelector(".fileDropZoneContent").style.color="#fff",Ss&&clearTimeout(Ss)),Ss=setTimeout((()=>{Xe.classList.remove("active"),Ss=void 0}),200)})),window.addEventListener("drop",(e=>{e.preventDefault(),Xe.classList.remove("active"),e.target.classList.contains("fileDropZoneContent")&&e.dataTransfer.files.length>0&&(e.dataTransfer.files[0].type.includes("image")?xs(e.dataTransfer.files[0]):Es(e.dataTransfer.files[0]))})),window.addEventListener("offline",(function(){console.log("offline"),document.querySelector(".offline .icon i").classList.replace("fa-wifi","fa-circle-exclamation"),document.querySelector(".offline .text").textContent="You are offline!",document.querySelector(".offline").classList.add("active"),document.querySelector(".chatBox").classList.add("offl"),document.querySelector(".offline").style.background="var(--primary-dark)"})),window.addEventListener("online",(function(){console.log("Back to online"),document.querySelector(".offline .icon i").classList.replace("fa-circle-exclamation","fa-wifi"),document.querySelector(".offline .text").textContent="Back to online!",document.querySelector(".offline").style.background="limegreen",setTimeout((()=>{document.querySelector(".offline").classList.remove("active"),document.querySelector(".chatBox").classList.remove("offl")}),1500)})),ot.addEventListener("click",(()=>{let e=Ue.value?.trim();if(Ue.value="",ls(),e.length){let t=$t();kt=!1,e.length>1e4&&(e=e.substring(0,1e4),e+="... (message too long)"),e=function(e){const t=new Map;t.set(":)","ðŸ™‚"),t.set(":'(","ðŸ˜¢"),t.set(":D","ðŸ˜€"),t.set(":P","ðŸ˜›"),t.set(":p","ðŸ˜›"),t.set(":O","ðŸ˜®"),t.set(":o","ðŸ˜®"),t.set(":|","ðŸ˜"),t.set(":/","ðŸ˜•"),t.set(":*","ðŸ˜˜"),t.set(">:(","ðŸ˜ "),t.set(":(","ðŸ˜ž"),t.set("o3o","ðŸ˜—"),t.set("^3^","ðŸ˜™"),t.set("^_^","ðŸ˜Š"),t.set("<3","â¤ï¸"),t.set(">_<","ðŸ˜£"),t.set(">_>","ðŸ˜’"),t.set("-_-","ðŸ˜‘"),t.set("XD","ðŸ˜†"),t.set("xD","ðŸ˜†"),t.set("B)","ðŸ˜Ž"),t.set(";)","ðŸ˜‰"),t.set("T-T","ðŸ˜­"),t.set(":aww:","ðŸ¥º"),t.set(":lol:","ðŸ˜‚"),t.set(":haha:","ðŸ¤£"),t.set(":hehe:","ðŸ˜…"),t.set(":meh:","ðŸ˜¶"),t.set(":hmm:","ðŸ˜"),t.set(":wtf:","ðŸ¤¨"),t.set(":yay:","ðŸ¥³"),t.set(":yolo:","ðŸ¤ª"),t.set(":yikes:","ðŸ˜±"),t.set(":sweat:","ðŸ˜…");for(let[s,n]of t)if(-1!=e.indexOf(s)){let t=e.indexOf(s),o=/[a-zA-Z0-9_!@#$%^&*()+\-=[\]{};':"\\|,.<>/?]/;if(e.charAt(t-1).match(o)||e.charAt(t+s.length).match(o))continue;e=e.replaceAll(s,n)}return e}(e),e=e.replace(/\n/g,"Â¶"),e=e.replace(/>/g,"&gt;"),e=e.replace(/</g,"&lt;"),Ft(e)&&(e=e.replace(/\s/g,""));let s="text"===Rt?.type?Rt?.message.substring(0,100):Rt?.message;Dt(e,"text",t,lt,{data:s,type:Rt?.type},Rt?.id,{reply:!!Rt.message,title:!!(Rt.message||mt>2)},{}),Ne.emit("message",e,"text",lt,{data:s,type:Rt?.type},Rt?.id,{reply:!!Rt.message,title:!!(Rt.message||mt>2)},(function(e){Ge.play(),document.getElementById(t).classList.add("delevered"),document.getElementById(t).id=e,At=e,document.hasFocus()&&Ne.emit("seen",{userId:lt,messageId:At,avatar:ut})}))}Rt.message="",Rt.type="",Rt.sender="",Rt.id="",Ue.focus(),Vt(),ts();try{clearTimeout(rt)}catch(e){console.log("timeout not set")}ct=!1,Ne.emit("stoptyping")})),document.getElementById("previewImage").querySelector(".close")?.addEventListener("click",(()=>{for(at.value="",it.value="",document.getElementById("previewImage")?.classList?.remove("active");document.getElementById("selectedImage").firstChild;)document.getElementById("selectedImage").removeChild(document.getElementById("selectedImage").firstChild)})),document.getElementById("previewImage").querySelector("#imageSend")?.addEventListener("click",(()=>{document.getElementById("previewImage")?.classList?.remove("active"),"image"===qt?async function(){let e=new Image;e.src=Ct.data,e.mimetype=Ct.ext,e.onload=async function(){let t={data:e.src,height:e.height,width:e.width},s=function(e,t,s=1080){let n=document.createElement("canvas"),o=e.width,a=e.height,i=s,r=s;return o>a?o>r&&(a=Math.round(a*=r/o),o=r):a>i&&(o=Math.round(o*=i/a),a=i),n.width=o,n.height=a,n.getContext("2d").drawImage(e,0,0,o,a),{data:n.toDataURL(t,1),height:a,width:o}}(e,e.mimetype,50),n=$t();kt=!1,Dt(t.data,"image",n,lt,{data:Rt?.message,type:Rt?.type},Rt?.id,{reply:!!Rt.message,title:!!(Rt.message||mt>2)},{ext:e.mimetype,size:t.data.length,height:t.height,width:t.width,name:Bt.name});let o=document.getElementById(n)?.querySelector(".messageMain");o.querySelector(".image").style.filter="brightness(0.4)";let a=0;$e.emit("fileUploadStart","image",s.data,lt,{data:Rt?.message,type:Rt?.type},Rt?.id,{reply:!!Rt.message,title:!!(Rt.message||mt>2)},{ext:e.mimetype,size:t.data.length,height:t.height,width:t.width,name:Bt.name},pt,(e=>{Ge.play(),document.getElementById(n).classList.add("delevered"),document.getElementById(n).id=e,n=e,At=e,document.hasFocus()&&Ne.emit("seen",{userId:lt,messageId:At,avatar:ut})}));let i=Ls(t.data,Ct.name),r=new FormData;r.append("uid",lt),r.append("key",pt),r.append("file",i),os();let c=new XMLHttpRequest;c.open("POST",`${location.origin}/api/files`,!0),c.upload.onprogress=function(e){e.lengthComputable&&(a=e.loaded/e.total*100,o.querySelector(".sendingImage").textContent="â†‘ "+Math.round(a)+"%")},c.onload=function(e){200==this.status?(o&&(o.querySelector(".sendingImage").remove(),o.querySelector(".image").style.filter="none"),document.getElementById(n).dataset.downloaded="true",$e.emit("fileUploadEnd",n,pt,JSON.parse(e.target.response).downlink)):(console.log("error uploading image"),o.querySelector(".sendingImage").textContent=this.responseText,$e.emit("fileUploadError",pt,n,"image"))},c.send(r)}}():"file"===qt&&async function(){let e=$t();kt=!1,Dt(Bt.data,"file",e,lt,{data:Rt?.message,type:Rt?.type},Rt?.id,{reply:!!Rt.message,title:!!(Rt.message||mt>2)},{ext:Bt.ext,size:Bt.size,name:Bt.name});let t=0,s=document.getElementById(e)?.querySelector(".messageMain");$e.emit("fileUploadStart","file","",lt,{data:Rt?.message,type:Rt?.type},Rt?.id,{reply:!!Rt.message,title:!!(Rt.message||mt>2)},{ext:Bt.ext,size:Bt.size,name:Bt.name},pt,(t=>{Ge.play(),document.getElementById(e).classList.add("delevered"),document.getElementById(e).id=t,e=t,At=t,document.hasFocus()&&Ne.emit("seen",{userId:lt,messageId:At,avatar:ut})}));let n=Ls(Bt.data,Bt.name),o=new FormData;o.append("uid",lt),o.append("key",pt),o.append("file",n),os();let a=new XMLHttpRequest;a.open("POST",location.origin+"/api/files",!0),a.upload.onprogress=function(e){e.lengthComputable&&(t=e.loaded/e.total*100,s.querySelector(".progress").textContent="â†‘ "+Math.round(t)+"%")},a.onload=function(t){200==this.status?(document.getElementById(e).dataset.downloaded="true",s.querySelector(".progress").style.visibility="hidden",$e.emit("fileUploadEnd",e,pt,JSON.parse(t.target.response).downlink)):(console.log("error uploading file"),s.querySelector(".progress").textContent="Error",$e.emit("fileUploadError",pt,e,"image"))},a.send(o)}(),ts()})),document.getElementById("lightbox__save").addEventListener("click",(()=>{Ht()})),Ue.addEventListener("keydown",(e=>{e.ctrlKey&&"Enter"===e.key&&ot.click()})),document.getElementById("send-location").addEventListener("click",(()=>{us("Tracing your location..."),navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{Ne.emit("createLocationMessage",{latitude:e.coords.latitude,longitude:e.coords.longitude})}),(e=>{us(e.message)})):us("Geolocation not supported by your browser.")})),document.querySelectorAll(".clickable").forEach((e=>{e.addEventListener("click",(()=>{st.currentTime=0,st.play()}))})),window.addEventListener("paste",(e=>{if(e.clipboardData){let t=e.clipboardData.items;if(t)for(let e=0;e<t.length;e++)if("file"===t[e].kind){let s=t[e].getAsFile();s.type.match("image.*")&&(Ct.data=s,Ct.ext=s.type.split("/")[1],Bt.name=s.name,Bt.size=s.size,qt="image",xs(s))}}})),Ne.on("connect",(()=>{const e={name:dt,id:lt,avatar:ut,key:pt,maxuser:mt};Ne.emit("join",e,(function(e){e?console.log(e):(console.log("no error"),bt.size>0&&(document.getElementById("typingIndicator").textContent=cs(bt)),document.getElementById("preload").style.display="none",us("Connected to server"),function(){ps.innerHTML="";for(let e of Oe.Stickers){const t=document.createElement("img");t.src=`/stickers/${e.name}/animated/${e.icon}.webp`,t.alt=e.name,t.dataset.name=e.name,t.classList.add("stickerName","clickable"),ps.append(t)}}(),fs(),"Notification"in window?Notification.requestPermission():us("Notifications not supported by your browser"))}))})),Ne.on("updateUserList",(e=>{for(e.forEach((e=>{xt.set(e.uid,e)})),document.getElementById("count").textContent=`${e.length}/${mt}`;document.getElementById("userlist").firstChild;)document.getElementById("userlist").removeChild(document.getElementById("userlist").firstChild);e.forEach((e=>{let t=`<li class="user" data-uid="${e.uid}"> <div class="avt"> <img src="/images/avatars/${e.avatar}(custom).png" height="30px" width="30px"/> <i class="fa-solid fa-circle activeStatus"></i> </div> ${e.uid==lt?e.name+" (You)":e.name}</li>`;if(e.uid==lt){const e=document.createRange().createContextualFragment(t);document.getElementById("userlist").prepend(e)}else{const e=document.createRange().createContextualFragment(t);document.getElementById("userlist").append(e)}}))})),Ne.on("server_message",((e,t)=>{switch(t){case"join":Je.play();break;case"leave":Ze.play();break;case"location":et.play()}!function(e,t){let s=`<li class="serverMessage msg-item" id="${e.id}"> <div class="messageContainer" style="color: ${e.color}"> ${e.text} </div> <div class="seenBy"></div> </li>`;const n=document.createRange().createContextualFragment(s);De.append(n),"location"==t?is("location",`${e.user}'s location`):"leave"==t?(bt.delete(e.who),document.querySelectorAll(`.msg-item[data-seen*="${e.who}"]`).forEach((t=>{t.querySelector(`.seenBy img[data-user="${e.who}"]`)?.remove(),ss(t.id)})),document.getElementById("typingIndicator").textContent=cs(bt),is()):is(),At=e.id,document.hasFocus()&&Ne.emit("seen",{userId:lt,messageId:At,avatar:ut})}(e,t)})),Ne.on("newMessage",((e,t,s,n,o,a,i)=>{"text"==t?Ke.play():"sticker"==t&&nt.play(),Dt(e,t,s,n,o,a,i,{}),Is({data:"text"==t?e:"",type:t[0].toUpperCase()+t.slice(1)},xt.get(n)?.name,xt.get(n)?.avatar)})),Ne.on("seen",(e=>{let t=document.getElementById(e.messageId);if(t&&!t.dataset.seen?.includes(e.userId)){document.querySelectorAll(`.msg-item[data-seen*="${e.userId}"]`).forEach((t=>{t.querySelector(`.seenBy img[data-user="${e.userId}"]`)?.remove(),ss(t?.id)})),t.dataset.seen=t.dataset.seen?t.dataset.seen+"|"+e.userId:e.userId;const s=document.createElement("img");s.src=`/images/avatars/${e.avatar}(custom)-mini.png`,s.dataset.user=e.userId,t.querySelector(".seenBy").appendChild(s),ss(t.id),is()}})),Ne.on("getReact",((e,t,s)=>{!function(e,t,s){try{let n=document.getElementById(t).querySelector(".reactedUsers");if(n?.querySelector(".list")){let t=n.querySelector('.list[data-uid="'+s+'"]');if(t)t.textContent==e?t.remove():t.textContent=e;else{tt.play();const t=document.createDocumentFragment(),o=document.createElement("div");o.classList.add("list"),o.dataset.uid=s,o.textContent=e,t.append(o),n.append(t)}}else{const t=document.createDocumentFragment(),o=document.createElement("div");o.classList.add("list"),o.dataset.uid=s,o.textContent=e,t.append(o),n.append(t),tt.play()}let o=new Map;o=function(e){let t=new Map;return e.forEach((e=>{t.set(e.textContent,t.get(e.textContent)+1||1)})),t}(Array.from(n.querySelectorAll(".list")));let a=document.getElementById(t).querySelector(".reactsOfMessage");if(a&&o.size>0){for(;a.firstChild;)a.removeChild(a.firstChild);let e=0;o.forEach(((t,s)=>{e>=2&&a.querySelector("span").remove();const n=document.createDocumentFragment(),o=document.createElement("span");o.textContent=`${s}${t}`,n.append(o),a.append(n),e++})),document.getElementById(t).classList.add("react"),ss(t)}else document.getElementById(t).classList.remove("react"),document.getElementById(t).querySelector(".seenBy").style.marginTop="0px",ss(t);is()}catch(e){console.log("Message not exists")}}(e,t,s)})),Ne.on("deleteMessage",((e,t)=>{!function(e,t){let s=document.getElementById(e);if(s){for(;s.querySelector(".messageMain").firstChild;)s.querySelector(".messageMain").removeChild(s.querySelector(".messageMain").firstChild);const n=document.createDocumentFragment(),o=document.createElement("p");o.textContent="Deleted message",n.append(o),s.querySelector(".messageMain").append(n),s.classList.add("deleted"),s.dataset.deleted=!0,s.querySelector(".messageTitle").textContent=t,us(`${t==dt?"You":t} deleted a message`),2!=mt&&s.dataset.uid!=lt||(s.querySelector(".messageTitle").style.visibility="hidden"),null!=s.querySelector(".messageReply")&&(s.querySelector(".messageReply").remove(),s.querySelector(".reactsOfMessage").remove(),s.querySelector(".reactedUsers").remove(),s.classList.remove("reply"),s.classList.remove("react"),s.querySelector(".seenBy").style.marginTop="0px",ss(e));let a=document.querySelectorAll(`[data-repid='${e}']`);null!=a&&a.forEach((e=>{e.classList.remove("imageReply"),e.style.background="#000000c4",e.style.color="#7d858c",e.textContent="Deleted message"})),Lt=De.scrollTop}}(e,t)})),Ne.on("typing",((e,t)=>{Qe.play(),bt.set(t,e),document.getElementById("typingIndicator").textContent=cs(bt)})),Ne.on("stoptyping",(e=>{bt.delete(e),0==bt.size?document.getElementById("typingIndicator").textContent="":document.getElementById("typingIndicator").textContent=cs(bt)})),Ne.on("disconnect",(()=>{console.log("disconnected"),us("Disconnected from server")})),$e.on("connect",(()=>{console.log("fileSocket connected"),$e.emit("join",pt)})),$e.on("fileDownloadStart",((e,t,s,n,o,a,i,r)=>{if(Ke.play(),Et.set(s,{type:e,data:"",uId:n,reply:o,replyId:a,options:i,metadata:r}),"image"===e){Dt(t,e,s,n,o,a,i,r);let c=document.getElementById(s).querySelector(".messageMain");setTimeout((()=>{c.querySelector(".image").style.filter="brightness(0.4) url(#sharpBlur)"}),4)}else Dt("",e,s,n,o,a,i,r),document.getElementById(s).querySelector(".messageMain").querySelector(".progress").textContent="â†‘ Uploading";Is({data:"",type:e[0].toUpperCase()+e.slice(1)},xt.get(n)?.name,xt.get(n)?.avatar)})),$e.on("fileUploadError",((e,t)=>{let s,n=document.getElementById(e).querySelector(".messageMain");s="image"===t?n.querySelector(".sendingImage"):n.querySelector(".progress"),s.textContent="Upload Error"})),$e.on("fileDownloadReady",((e,t)=>{if(!Et.has(e))return;let s,n=Et.get(e).type,o=document.getElementById(e).querySelector(".messageMain");s="image"===n?o.querySelector(".sendingImage"):o.querySelector(".progress"),Et.delete(e);let a=new XMLHttpRequest;a.open("GET",`${location.origin}/api/download/${t}`,!0),a.responseType="blob",a.onprogress=async function(e){if(e.lengthComputable&&s){let t=Math.round(e.loaded/e.total*100);s.textContent=`â†“ ${t}%`}},a.onload=function(){if(200==this.status){let s=this.response,a=new FileReader;a.readAsDataURL(s),a.onloadend=function(){if(o){let s=a.result;!function(e,t,s){Ge.play(),"image"===s?setTimeout((()=>{e.querySelector(".sendingImage").remove(),e.querySelector(".image").src=t,e.querySelector(".image").alt="image",e.querySelector(".image").style.filter="none"}),4):"file"===s&&setTimeout((()=>{e.querySelector(".file").dataset.data=t,e.querySelector(".progress").style.visibility="hidden"}),4),e.closest(".message").dataset.downloaded="true"}(o,s,n),$e.emit("fileDownloaded",lt,pt,t),"image"===n&&document.querySelectorAll(`.messageReply[data-repid="${e}"`).forEach((e=>{e.querySelector(".image").src=s}))}}}else 404==this.status&&(console.log("404"),s.textContent="File deleted")},a.send(),is()})),Nt(),is(),document.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{document.getElementById("preload").querySelector(".text").textContent="Slow internet"}),3e3)})),document.addEventListener("click",(()=>{history.pushState({},"","#init"),history.pushState({},"","#initiated"),history.pushState({},"","#inbox"),window.onpopstate=()=>{history.forward()}}),{once:!0})})()})();